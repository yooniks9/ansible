---
- name: Check is .zshrc exist?
  stat:
    path: /home/{{ user }}/.zshrc
  register: zshrc

- name: Install Z shell
  apt:
    name: zsh
    state: latest
    force_apt_get: yes
  when: zshrc.stat.exists == False

- name: Download zsh installer
  git:
    repo: 'https://github.com/robbyrussell/oh-my-zsh.git'
    dest: /home/{{ user }}/.oh-my-zsh
    update: no
  when: zshrc.stat.exists == False

- name: Change ownership to {{ user }}
  file:
    dest: /home/{{ user }}/.oh-my-zsh
    owner: "{{ user }}"
    group: "{{ user }}"
    recurse: yes
  when: zshrc.stat.exists == False

- name: Copy Zsh profiles
  template: 
    src: zshrc.j2 
    dest: /home/{{ user }}/.zshrc
    owner: "{{ user }}"
    group: "{{ user }}"
    mode : 0644
  when: zshrc.stat.exists == False

- name: Change current user to Z shell
  shell: chsh -s `which zsh` {{ user }}
  when: zshrc.stat.exists == False